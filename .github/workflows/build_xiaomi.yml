name: Build hosts_redirect - FIXED

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout Code AND Submodules
      uses: actions/checkout@v4
      with:
        # 核心修复：递归拉取所有子模块，确保KernelPatch到位
        submodules: recursive
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: Build the Module
      run: |
        # 进入模块目录，使用作者预设的Makefile直接编译
        cd hosts_redirect
        make

    - name: Upload Compiled Module
      uses: actions/upload-artifact@v4
      with:
        name: hosts_redirect-module
        path: hosts_redirect/*.kpm
        retention-days: 1
